

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TUM-VI Rectification &mdash; Dense Reconstruction Toolkit  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Trajectory Visualization" href="../trajectory_visualization/index.html" />
    <link rel="prev" title="Realsense Recording and Conversion to EuRoC" href="realsense_bag.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Dense Reconstruction Toolkit
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Tutorials:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/quickstart.html">Quick Start</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Documentation:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Euroc Preparation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="realsense_bag.html">Realsense Recording and Conversion to EuRoC</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">TUM-VI Rectification</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#scripts">Scripts</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../trajectory_visualization/index.html">Trajectory Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extras/index.html">Extras</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Third-Party Tools:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../third-party-tools/basalt.html">Basalt - Visual Inertial Odometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../third-party-tools/monorec.html">MonoRec - Dense Reconstruction</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Community:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../developers.html">Main developers</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Dense Reconstruction Toolkit</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Euroc Preparation</a></li>
      <li class="breadcrumb-item active">TUM-VI Rectification</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/hardik01shah/DenseReconstructionTools/blob/master/docs/documentation/euroc-preparation/tumvi.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="tum-vi-rectification">
<h1>TUM-VI Rectification<a class="headerlink" href="#tum-vi-rectification" title="Link to this heading"></a></h1>
<p>The tum-vi dataset has been recorded from a handheld setup consisting of various sensors
i.e. cameras (2), imu and motion-capture. The images recorded from the two cameras are distorted as
the camera-model is a double-sphere or fisheye model. However, MonoRec works only on rectified images.
Hence the tumvi dataset must be rectified. The following opencv functions handle image rectification
and have been used for the same:</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://docs.opencv.org/3.4/db/d58/group__calib3d__fisheye.html#gac1af58774006689056b0f2ef1db55ecc">seteroRectify()</a></p></li>
<li><p><a class="reference external" href="https://docs.opencv.org/3.4/db/d58/group__calib3d__fisheye.html#ga0d37b45f780b32f63ed19c21aa9fd333">initUndistortRectifyMap()</a></p></li>
</ol>
<p>In general, the camera intrinsic matrix is a 3x3 of the format:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>fx 0  cx
0  fy cy
0  0  1
</pre></div>
</div>
<p>The projection matrix P generated as an output of
the <a class="reference external" href="https://docs.opencv.org/3.4/db/d58/group__calib3d__fisheye.html#gac1af58774006689056b0f2ef1db55ecc">seteroRectify()</a> function is a 3x4 matrix of the format:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>fx 0  cx fx.tx
0  fy cy 0
0  0  1  0
</pre></div>
</div>
<p>The camera extrinsics are represented in the homogenous matrix format of 4x4 as:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>r11 r12 r13 tx
r21 r22 r23 ty
r31 r32 r33 tz
0   0   0   1
</pre></div>
</div>
<p>The 3x3 top-left matrix is the rotation matrix and the 3x1 last column is the translation vector (tx, ty, tz).</p>
<p>For running the scripts for tum-vi rectification, create a new conda environment from
the given <a class="reference external" href="https://github.com/hardik01shah/DenseReconstructionTools/blob/master/environment.yml">environment.yml</a> file using:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>conda env create -f environment.yml
</pre></div>
</div>
<section id="scripts">
<h2>Scripts<a class="headerlink" href="#scripts" title="Link to this heading"></a></h2>
<p>1. <a class="reference external" href="https://github.com/hardik01shah/DenseReconstructionTools/blob/master/euroc-preparation/tumvi/tumvi_preparation.py">tumvi_preparation.py</a>
is used for getting the downloaded and extracted sequences in the required format i.e. renaming sequences names to _00_, _01_ ..</p>
<p>2. <a class="reference external" href="https://github.com/hardik01shah/DenseReconstructionTools/blob/master/euroc-preparation/tumvi/tumvi_rectification/rectify.py">rectify.py</a>
is used for rectification of a single tum-vi sequence. The script also has the option
of saving the updated basalt calibration file using the new intrinsics and extrinsics.</p>
<blockquote>
<div><div class="highlight-text notranslate"><div class="highlight"><pre><span></span>usage: rectify.py [-h] [-fov FIELD_OF_VIEW_SCALE] [-sc NEW_SCALE] [-rp RECTIFIED_DIRNAME] [-ip INTRINSIC_PATH] [-bp BASALT_PATH] [-bcn BASALT_CALIB_NAME] dataset_path

Python code for rectification of TUM-VI sequences. Updated camera intrinsics and extrensics are written to a json file for basalt.

positional arguments:
dataset_path          path to tum-vi sequence

optional arguments:
-h, --help            show this help message and exit
-fov FIELD_OF_VIEW_SCALE, --field-of-view-scale FIELD_OF_VIEW_SCALE
                        field of view scale for the new rectified image
-sc NEW_SCALE, --new-scale NEW_SCALE
                        Scale for the new image size. New image size will be scale times the orig image size.
-rp RECTIFIED_DIRNAME, --rectified-dirname RECTIFIED_DIRNAME
                        Directory name of the rectified dataset
-ip INTRINSIC_PATH, --intrinsic-path INTRINSIC_PATH
                        Path for saving the intrinsics file (.yaml). Used only when intrinsics need to be saved without rectifying the entire dataset.
-bp BASALT_PATH, --basalt-path BASALT_PATH
                        Path to basalt directory. Use to update rectified camera parameters in basalt.
-bcn BASALT_CALIB_NAME, --basalt-calib-name BASALT_CALIB_NAME
                        Name of the calib file for basalt.

E.g.
python3 rectify.py -fov 0.25 -sc 0.5 -rp test ../../tumvi_data/dataset-outdoors1_1024_16
</pre></div>
</div>
</div></blockquote>
<p>3. <a class="reference external" href="https://github.com/hardik01shah/DenseReconstructionTools/blob/master/euroc-preparation/tumvi/tumvi_rectification/rectify_full_tumvi.py">rectify_full_tumvi.py</a> is
used for rectification of the tum-vi dataset i.e. contains several sequences.</p>
<blockquote>
<div><div class="highlight-text notranslate"><div class="highlight"><pre><span></span>usage: rectify_full_tumvi.py [-h] [-fov FIELD_OF_VIEW_SCALE] [-sc NEW_SCALE] [-bp BASALT_PATH] dataset_path

Python code for rectification of TUM-VI sequences. Updated camera intrinsics and extrensics are written to a json file for basalt.

positional arguments:
dataset_path          path to tum-vi sequence

optional arguments:
-h, --help            show this help message and exit
-fov FIELD_OF_VIEW_SCALE, --field-of-view-scale FIELD_OF_VIEW_SCALE
                        field of view scale for the new rectified image
-sc NEW_SCALE, --new-scale NEW_SCALE
                        Scale for the new image size. New image size will be scale times the orig image size.
-bp BASALT_PATH, --basalt-path BASALT_PATH
                        Path to basalt directory. Use to update rectified camera parameters in basalt.

E.g.
python rectify_full_tumvi.py -fov 0.25 -sc 0.5 -bp ../basalt ../../tumvi-dataset/
</pre></div>
</div>
</div></blockquote>
<p>4. <a class="reference external" href="https://github.com/hardik01shah/DenseReconstructionTools/blob/master/euroc-preparation/tumvi/tumvi_rectification/prep_basalt.py">prep_basalt.py</a> is
used for generating a json calibration file for running basalt from a euroc dataset
i.e. dso/camchain.yaml</p>
<blockquote>
<div><div class="highlight-text notranslate"><div class="highlight"><pre><span></span>usage: prep_basalt.py [-h] tumvi_path basalt_path calib_name

Python code for using TUM-VI dataset to update camera intrinsics and extrensics for basalt.

positional arguments:
tumvi_path   path to tum-vi sequence
basalt_path  path to basalt directory
calib_name   name of new calib file for basalt

optional arguments:
-h, --help   show this help message and exit

E.g.
python3 prep_basalt.py ../../tumvi_data/dataset-outdoors1_512_16_rectified ../basalt test
</pre></div>
</div>
</div></blockquote>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="realsense_bag.html" class="btn btn-neutral float-left" title="Realsense Recording and Conversion to EuRoC" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../trajectory_visualization/index.html" class="btn btn-neutral float-right" title="Trajectory Visualization" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Robot Vision Lab, HKA. Author(s): Hardik Shah, Niclas Zeller.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>